{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./public/javascripts/compress.js","webpack:///./public/javascripts/loadUsername.js","webpack:///./public/javascripts/getImgData.js","webpack:///./public/javascripts/loadImg.js","webpack:///./public/javascripts/main.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","r","value","n","__esModule","object","property","prototype","hasOwnProperty","p","s","img","src","length","ratio","count","width","height","Math","sqrt","canvas","ctx","fillStyle","fillRect","nw","nh","tCanvas","j","tctx","drawImage","ndata","toDataURL","username","$","localStorage","setItem","console","log","dir","next","image","Image","onload","drawWidth","drawHeight","degree","this","naturalWidth","naturalHeight","maxSide","max","minSide","min","document","createElement","context","getContext","rotate","PI","event","undefined","getItem","alert","Orientation","file","target","files","indexOf","type","split","size","reader","FileReader","EXIF","getData","getTag","result","_getImgData2","default","rotateData","css","hide","callback","data","_compress2","ajax","url","b64f","done","fail","always","complete","readAsDataURL","click","backgroundColor","zIndex","display","window","headimgurl","nickname","getElementById","addEventListener","loadUsername","loadImg"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 6);\n","export default function compress(img) {\r\n    var initSize = img.src.length;\r\n    var width = img.width;\r\n    var height = img.height;\r\n    //如果图片大于四百万像素，计算压缩比并将大小压至400万以下\r\n    var ratio;\r\n    if ((ratio = width * height / 4000000) > 1) {\r\n        ratio = Math.sqrt(ratio);\r\n        width /= ratio;\r\n        height /= ratio;\r\n    } else {\r\n        ratio = 1;\r\n    }\r\n    canvas.width = width;\r\n    canvas.height = height;\r\n    //        铺底色\r\n    ctx.fillStyle = \"#fff\";\r\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n    //如果图片像素大于100万则使用瓦片绘制\r\n    var count;\r\n    if ((count = width * height / 1000000) > 1) {\r\n        count = ~~(Math.sqrt(count) + 1); //计算要分成多少块瓦片\r\n        //            计算每块瓦片的宽和高\r\n        var nw = ~~(width / count);\r\n        var nh = ~~(height / count);\r\n        tCanvas.width = nw;\r\n        tCanvas.height = nh;\r\n        for (var i = 0; i < count; i++) {\r\n            for (var j = 0; j < count; j++) {\r\n                tctx.drawImage(img, i * nw * ratio, j * nh * ratio, nw * ratio, nh * ratio, 0, 0, nw, nh);\r\n                ctx.drawImage(tCanvas, i * nw, j * nh, nw, nh);\r\n            }\r\n        }\r\n    } else {\r\n        ctx.drawImage(img, 0, 0, width, height);\r\n    }\r\n    //进行最小压缩\r\n    var ndata = canvas.toDataURL('image/jpeg', 0.1);\r\n    tCanvas.width = tCanvas.height = canvas.width = canvas.height = 0;\r\n    return ndata;\r\n}","export default function loadUsername(){\r\n    const username = $('#username')[0].value;\r\n    localStorage.setItem('username', username);\r\n    console.log(localStorage);\r\n}","export default function getImgData(img, dir, next) {\r\n    var image = new Image();\r\n    image.onload = function() {\r\n        var degree = 0,\r\n            drawWidth, drawHeight, width, height;\r\n        drawWidth = this.naturalWidth;\r\n        drawHeight = this.naturalHeight;\r\n        //以下改变一下图片大小\r\n        var maxSide = Math.max(drawWidth, drawHeight);\r\n        if (maxSide > 1024) {\r\n            var minSide = Math.min(drawWidth, drawHeight);\r\n            minSide = minSide / maxSide * 1024;\r\n            maxSide = 1024;\r\n            if (drawWidth > drawHeight) {\r\n                drawWidth = maxSide;\r\n                drawHeight = minSide;\r\n            } else {\r\n                drawWidth = minSide;\r\n                drawHeight = maxSide;\r\n            }\r\n        }\r\n        var canvas = document.createElement('canvas');\r\n        canvas.width = width = drawWidth;\r\n        canvas.height = height = drawHeight;\r\n        var context = canvas.getContext('2d');\r\n        //判断图片方向，重置canvas大小，确定旋转角度，iphone默认的是home键在右方的横屏拍摄方式\r\n        switch (dir) {\r\n            //iphone横屏拍摄，此时home键在左侧\r\n            case 3:\r\n                degree = 180;\r\n                drawWidth = -width;\r\n                drawHeight = -height;\r\n                break;\r\n                //iphone竖屏拍摄，此时home键在下方(正常拿手机的方向)\r\n            case 6:\r\n                canvas.width = height;\r\n                canvas.height = width;\r\n                degree = 90;\r\n                drawWidth = width;\r\n                drawHeight = -height;\r\n                break;\r\n                //iphone竖屏拍摄，此时home键在上方\r\n            case 8:\r\n                canvas.width = height;\r\n                canvas.height = width;\r\n                degree = 270;\r\n                drawWidth = -width;\r\n                drawHeight = height;\r\n                break;\r\n        }\r\n        //使用canvas旋转校正\r\n        context.rotate(degree * Math.PI / 180);\r\n        context.drawImage(this, 0, 0, drawWidth, drawHeight);\r\n        //返回校正图片\r\n        next(canvas.toDataURL(\"image/jpeg\", .8));\r\n    }\r\n    image.src = img;\r\n}","import compress from './compress.js';\r\nimport getImgData from './getImgData.js';\r\n\r\nexport default function loadImg(event) {\r\n    if (localStorage.getItem('username') == undefined) {\r\n        alert('请先输入名字');\r\n        return;\r\n    }\r\n    var Orientation;\r\n    // 获取当前选中的文件\r\n    const file = event.target.files[0];\r\n    const maxsize = 10000 * 1024;\r\n    const uploadmax = 100 * 1024;\r\n    // 检查文件类型\r\n    if (['jpeg', 'png', 'gif', 'jpg'].indexOf(file.type.split(\"/\")[1]) < 0) {\r\n        alert(\"文件格式不对\");\r\n        return;\r\n    }\r\n    // 文件大小限制\r\n    if (file.size > maxsize) {\r\n        alert(\"文件过大\");\r\n        return;\r\n    }\r\n    if (!this.files.length) return;\r\n    var reader = new FileReader();\r\n    var size = file.size / 1024 > 1024 ? (~~(10 * file.size / 1024 / 1024)) / 10 + \"MB\" : ~~(file.size / 1024) + \"KB\";\r\n    EXIF.getData(file, function() { /*获取图片方向信息*/\r\n        Orientation = EXIF.getTag(this, 'Orientation') || '';\r\n        console.log(Orientation)\r\n    });\r\n    reader.onload = function() {\r\n        var result = this.result;\r\n        var img = new Image();\r\n\r\n        if (Orientation === 3 || Orientation === 6 || Orientation === 8) {\r\n            // console.log(Orientation)\r\n            getImgData(result, Orientation, function(rotateData) { /*7.15*/\r\n                    console.log(rotateData == result)\r\n                    img.src = rotateData;\r\n                    $('.photoinput').css(\"background-image\", \"url(\" + rotateData + \")\");\r\n                    $('.cameraContainer').hide();\r\n                    $('.add').hide();\r\n                })\r\n            }\r\n            if (Orientation === '' || Orientation === 1) {\r\n                $('.photoinput').css(\"background-image\", \"url(\" + result + \")\");\r\n                $('.cameraContainer').hide();\r\n                $('.add').hide();\r\n            }\r\n\r\n\r\n            //如果图片大小小于100kb，则直接上传\r\n            if (result.length <= uploadmax) {\r\n                img = null;\r\n                localStorage.setItem('img', result);\r\n                return;\r\n            }\r\n            //      图片加载完毕之后进行压缩，然后上传\r\n            if (img.complete) {\r\n                callback();\r\n            } else {\r\n                img.onload = callback;\r\n            }\r\n\r\n            function callback() {\r\n                var data = compress(img);\r\n                localStorage.setItem('img', data);\r\n                var name = localStorage.getItem('username');\r\n                $.ajax({\r\n                        url: 'https://wx.idsbllp.cn/graduate/u/upload/',\r\n                        type: 'POST',\r\n                        data: {\r\n                            b64f: data,\r\n                            name: name\r\n                        }\r\n                    })\r\n                    .done(function() {\r\n                        console.log(\"success\");\r\n                    })\r\n                    .fail(function() {\r\n                        console.log(\"error\");\r\n                    })\r\n                    .always(function() {\r\n                        console.log(\"complete\");\r\n                    });\r\n                img = null;\r\n            }\r\n        };\r\n        reader.readAsDataURL(file);\r\n    }","import compress from './compress.js'\r\nimport loadImg from './loadImg.js'\r\nimport loadUsername from './loadUsername.js'\r\n\r\n$('.members').click(function(event) {\r\n    $('.black').css({\r\n        backgroundColor: 'rgba(0,0,0,0.7)',\r\n        zIndex: '10000'\r\n    });\r\n    $('.membersContainer').css({\r\n        display: 'block'\r\n    });\r\n});\r\n\r\n$('.close').click(function(event) {\r\n    $('.membersContainer').css({\r\n        display: 'none'\r\n    });\r\n    $('.black').css({\r\n        backgroundColor: 'rgba(0,0,0,0)',\r\n        zIndex: '-1'\r\n    });\r\n});\r\n\r\n\r\n\r\nfunction getUserinfo() {\r\n    $.ajax({\r\n        url: 'https://wx.idsbllp.cn/graduate/c/getsinfo/ ',\r\n        type: 'POST',\r\n    })\r\n    .done(function(data) {\r\n        console.log(data);\r\n        localStorage.setItem('headimgurl',data.headimgurl);\r\n        localStorage.setItem('nickname',data.nickname);\r\n    })\r\n    .fail(function() {\r\n        console.log(\"error\");\r\n    })\r\n    .always(function() {\r\n        console.log(\"complete\");\r\n    });\r\n    \r\n}\r\n\r\n\r\nwindow.onload = getUserinfo();\r\ndocument.getElementById('username').addEventListener('change', loadUsername)\r\ndocument.getElementById('camera_image').addEventListener('change', loadImg)"],"sourceRoot":""}